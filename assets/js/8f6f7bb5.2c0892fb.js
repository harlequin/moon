"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[56765],{15825:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/cpu-selected-febbd2aef4ffaea46979cbeb583bd648.png"},33408:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"guides/profile","title":"Task profiling","description":"Troubleshooting slow or unperformant tasks? Profile and diagnose them with ease!","source":"@site/docs/guides/profile.mdx","sourceDirName":"guides","slug":"/guides/profile","permalink":"/docs/guides/profile","draft":false,"unlisted":false,"editUrl":"https://github.com/moonrepo/moon/tree/master/website/docs/guides/profile.mdx","tags":[],"version":"current","frontMatter":{"title":"Task profiling"},"sidebar":"guides","previous":{"title":"Node.js handbook","permalink":"/docs/guides/javascript/node-handbook"},"next":{"title":"TypeScript project references","permalink":"/docs/guides/javascript/typescript-project-refs"}}');var t=s(62540),r=s(43023);function i(e){let{alt:n,src:s}=e;return(0,t.jsx)("div",{className:"m-3 text-center",children:(0,t.jsx)("img",{alt:n,src:s.default,className:"block w-auto max-w-full"})})}const a={title:"Task profiling"},l=void 0,d={},c=[{value:"CPU snapshots",id:"cpu-snapshots",level:2},{value:"Record a profile",id:"record-a-profile",level:3},{value:"Analyze in Chrome",id:"analyze-in-chrome",level:3},{value:"Heap snapshots",id:"heap-snapshots",level:2},{value:"Record a profile",id:"record-a-profile-1",level:3},{value:"Analyze in Chrome",id:"analyze-in-chrome-1",level:3},{value:"Views",id:"views",level:2},{value:"Bottom up",id:"bottom-up",level:3},{value:"Top down",id:"top-down",level:3},{value:"Flame chart",id:"flame-chart",level:3}];function h(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Troubleshooting slow or unperformant tasks? Profile and diagnose them with ease!"}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Profiling is only supported by ",(0,t.jsx)(n.code,{children:"node"})," based tasks, and is not supported by tasks that are created\nthrough ",(0,t.jsx)(n.code,{children:"package.json"})," inference, or for packages that ship non-JavaScript code (like Rust or Go)."]})}),"\n",(0,t.jsx)(n.h2,{id:"cpu-snapshots",children:"CPU snapshots"}),"\n",(0,t.jsx)(n.p,{children:"CPU profiling helps you get a better understanding of which parts of your code require the most CPU\ntime, and how your code is executed and optimized by Node.js. The profiler will measure code\nexecution and activities performed by the engine itself, such as compilation, calls of system\nlibraries, optimization, and garbage collection."}),"\n",(0,t.jsx)(n.h3,{id:"record-a-profile",children:"Record a profile"}),"\n",(0,t.jsxs)(n.p,{children:["To record a CPU profile, pass ",(0,t.jsx)(n.code,{children:"--profile cpu"})," to the ",(0,t.jsx)(n.a,{href:"../commands/run",children:(0,t.jsx)(n.code,{children:"moon run"})})," command. When\nsuccessful, the profile will be written to\n",(0,t.jsx)(n.code,{children:".moon/cache/states/<project>/<task>/snapshot.cpuprofile"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ moon run --profile cpu app:lint\n"})}),"\n",(0,t.jsx)(n.h3,{id:"analyze-in-chrome",children:"Analyze in Chrome"}),"\n",(0,t.jsxs)(n.p,{children:["CPU profiles can be reviewed and analyzed with\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/docs/devtools/",children:"Chrome developer tools"})," using the following steps."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open Chrome and navigate to ",(0,t.jsx)(n.code,{children:"chrome://inspect"}),"."]}),"\n",(0,t.jsx)(n.li,{children:'Under "Devices", navigate to "Open dedicated DevTools for Node".'}),"\n",(0,t.jsx)(n.li,{children:'The following window will popup. Ensure the "Profiler" tab is selected.'}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(46947),alt:"DevTools Profiler - CPU"}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:['Click "Load" and select the ',(0,t.jsx)(n.code,{children:"snapshot.cpuprofile"})," that was\n",(0,t.jsx)(n.a,{href:"#record-a-profile",children:"previously recorded"}),". If successful, the snapshot will appear in the left\ncolumn."]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["On macOS, press ",(0,t.jsx)(n.code,{children:"command"})," + ",(0,t.jsx)(n.code,{children:"shift"})," + ",(0,t.jsx)(n.code,{children:"."})," to display hidden files and folders, to locate the\n",(0,t.jsx)(n.code,{children:".moon"})," folder."]}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(90065),alt:"DevTools Profiler - CPU snapshot loaded"}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsxs)(n.li,{children:["Select the snapshot in the left column. From here, the snapshot can be analyzed and represented\nwith ",(0,t.jsx)(n.a,{href:"#bottom-up",children:"Bottom up"}),", ",(0,t.jsx)(n.a,{href:"#top-down",children:"Top down"}),", or ",(0,t.jsx)(n.a,{href:"#flame-chart",children:"Flame chart"})," views."]}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(15825),alt:"DevTools Profiler - CPU snapshot being analyzed through charts"}),"\n",(0,t.jsx)(n.h2,{id:"heap-snapshots",children:"Heap snapshots"}),"\n",(0,t.jsx)(n.p,{children:"Heap profiling lets you detect memory leaks, dynamic memory problems, and locate the fragments of\ncode that caused them."}),"\n",(0,t.jsx)(n.h3,{id:"record-a-profile-1",children:"Record a profile"}),"\n",(0,t.jsxs)(n.p,{children:["To record a heap profile, pass ",(0,t.jsx)(n.code,{children:"--profile heap"})," to the ",(0,t.jsx)(n.a,{href:"../commands/run",children:(0,t.jsx)(n.code,{children:"moon run"})})," command. When\nsuccessful, the profile will be written to\n",(0,t.jsx)(n.code,{children:".moon/cache/states/<project>/<task>/snapshot.heapprofile"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ moon run --profile heap app:lint\n"})}),"\n",(0,t.jsx)(n.h3,{id:"analyze-in-chrome-1",children:"Analyze in Chrome"}),"\n",(0,t.jsxs)(n.p,{children:["Heap profiles can be reviewed and analyzed with\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/docs/devtools/",children:"Chrome developer tools"})," using the following steps."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open Chrome and navigate to ",(0,t.jsx)(n.code,{children:"chrome://inspect"}),"."]}),"\n",(0,t.jsx)(n.li,{children:'Under "Devices", navigate to "Open dedicated DevTools for Node".'}),"\n",(0,t.jsx)(n.li,{children:'The following window will popup. Ensure the "Memory" tab is selected.'}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(61327),alt:"DevTools Profiler - Heap"}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:['Click "Load" and select the ',(0,t.jsx)(n.code,{children:"snapshot.heapprofile"})," that was\n",(0,t.jsx)(n.a,{href:"#record-a-profile-1",children:"previously recorded"}),". If successful, the snapshot will appear in the left\ncolumn."]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["On macOS, press ",(0,t.jsx)(n.code,{children:"command"})," + ",(0,t.jsx)(n.code,{children:"shift"})," + ",(0,t.jsx)(n.code,{children:"."})," to display hidden files and folders, to locate the\n",(0,t.jsx)(n.code,{children:".moon"})," folder."]}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(86677),alt:"DevTools Profiler - Heap snapshot loaded"}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsxs)(n.li,{children:["Select the snapshot in the left column. From here, the snapshot can be analyzed and represented\nwith ",(0,t.jsx)(n.a,{href:"#bottom-up",children:"Bottom up"}),", ",(0,t.jsx)(n.a,{href:"#top-down",children:"Top down"}),", or ",(0,t.jsx)(n.a,{href:"#flame-chart",children:"Flame chart"})," views."]}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(62477),alt:"DevTools Profiler - Heap snapshot being analyzed through charts"}),"\n",(0,t.jsx)(n.h2,{id:"views",children:"Views"}),"\n",(0,t.jsx)(n.p,{children:"Chrome DevTools provide 3 views for analyzing activities within a snapshot. Each view gives you a\ndifferent perspective on these activities."}),"\n",(0,t.jsx)(n.h3,{id:"bottom-up",children:"Bottom up"}),"\n",(0,t.jsx)(n.p,{children:"The Bottom up view is helpful if you encounter a heavy function and want to find out where it was\ncalled from."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'The "Self Time" column represents the aggregated time spent directly in that activity, across all\nof its occurrences.'}),"\n",(0,t.jsx)(n.li,{children:'The "Total Time" column represents aggregated time spent in that activity or any of its children.'}),"\n",(0,t.jsx)(n.li,{children:'The "Function" column is the function that was executed, including source location, and any\nchildren.'}),"\n"]}),"\n",(0,t.jsx)(i,{src:s(80196),alt:"Bottom up profiler view"}),"\n",(0,t.jsx)(n.h3,{id:"top-down",children:"Top down"}),"\n",(0,t.jsxs)(n.p,{children:["The Top down view works in a similar fashion to ",(0,t.jsx)(n.a,{href:"#bottom-up",children:"Bottom up"}),", but displays functions\nstarting from the top-level entry points. These are also known as root activities."]}),"\n",(0,t.jsx)(i,{src:s(51779),alt:"Top down profiler view"}),"\n",(0,t.jsx)(n.h3,{id:"flame-chart",children:"Flame chart"}),"\n",(0,t.jsx)(n.p,{children:"DevTools represents main thread activity with a flame chart. The x-axis represents the recording\nover time. The y-axis represents the call stack. The events on top cause the events below it."}),"\n",(0,t.jsx)(i,{src:s(89959),alt:"Flame chart profiler view"})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},43023:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var o=s(63696);const t={},r=o.createContext(t);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(r.Provider,{value:n},e.children)}},46947:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/cpu-deb9e0f9310721da8e3394071dbaa637.png"},51779:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/top-down-409f6e1447d9875d7013017d0c7f643c.png"},61327:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/heap-3451a7088c4f41a89ad4e068d250f6b4.png"},62477:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/heap-selected-41365c3cb6e1244aa6dd2382e58b5804.png"},80196:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/bottom-up-2e2e925bb1bd78f49bf29e4f6f848f7c.png"},86677:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/heap-loaded-4bbbd3b5dd677a0d5bbdce7585ea3286.png"},89959:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/flame-chart-aa69d1306f8472d449c7d9755e7995e8.png"},90065:(e,n,s)=>{s.r(n),s.d(n,{default:()=>o});const o=s.p+"assets/images/cpu-loaded-ff6afad307a77cc32e53364c0cd3a597.png"}}]);