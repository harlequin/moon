"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[84667],{43023:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>s});var o=t(63696);const i={},a=o.createContext(i);function r(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:n},e.children)}},46010:e=>{e.exports=JSON.parse('{"permalink":"/blog/v0.20","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2022-11-29_v0.20.mdx","source":"@site/blog/2022-11-29_v0.20.mdx","title":"moon v0.20 - Toolchain, caching, and hydration improvements","description":"With this release, we\'ve focused heavily on future proofing our toolchain and how it integrates with","date":"2022-11-29T00:00:00.000Z","tags":[{"inline":true,"label":"hydration","permalink":"/blog/tags/hydration"},{"inline":true,"label":"toolchain","permalink":"/blog/tags/toolchain"},{"inline":true,"label":"generator","permalink":"/blog/tags/generator"},{"inline":true,"label":"runner","permalink":"/blog/tags/runner"}],"readingTime":3.93,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"v0.20","title":"moon v0.20 - Toolchain, caching, and hydration improvements","authors":["milesj"],"tags":["hydration","toolchain","generator","runner"],"image":"./img/v0.20.png"},"unlisted":false,"prevItem":{"title":"moon v0.21 - Tiered language support with initial Go, PHP, Python, Ruby, and Rust","permalink":"/blog/v0.21"},"nextItem":{"title":"Integrating TypeScript in a monorepo","permalink":"/blog/typescript-monorepo"}}')},51916:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var o=t(46010),i=t(62540),a=t(43023);const r={slug:"v0.20",title:"moon v0.20 - Toolchain, caching, and hydration improvements",authors:["milesj"],tags:["hydration","toolchain","generator","runner"],image:"./img/v0.20.png"},s=void 0,l={image:t(78660).A,authorsImageUrls:[void 0]},c=[{value:"Breaking changes",id:"breaking-changes",level:2},{value:"Moved toolchain settings",id:"moved-toolchain-settings",level:3},{value:"Moved project-level overrides",id:"moved-project-level-overrides",level:3},{value:"Future of the toolchain",id:"future-of-the-toolchain",level:2},{value:"Increased output hydration by 8-10x",id:"increased-output-hydration-by-8-10x",level:2},{value:"Cache any and all targets",id:"cache-any-and-all-targets",level:2},{value:"Path handling in generator templates",id:"path-handling-in-generator-templates",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"With this release, we've focused heavily on future proofing our toolchain and how it integrates with\nmoon. We've also landed a handful of quality of life improvements."}),"\n",(0,i.jsx)(n.h2,{id:"breaking-changes",children:"Breaking changes"}),"\n",(0,i.jsx)(n.p,{children:"To start, we have a few breaking changes this release to be aware of!"}),"\n",(0,i.jsx)(n.h3,{id:"moved-toolchain-settings",children:"Moved toolchain settings"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"../docs/config/workspace",children:(0,i.jsx)(n.code,{children:".moon/workspace.yml"})})," config file was getting rather bloated and\ncomplicated, as it contained the projects list, settings for each toolchain language, and settings\nfor each supported service (runner, generator, etc). Furthermore, this file will keep getting larger\nwith each new language and service we support."]}),"\n",(0,i.jsxs)(n.p,{children:["To future proof moon, and to land as many breaking changes before an official v1, we've decided to\nmove toolchain specific settings into a new file, ",(0,i.jsx)(n.a,{href:"../docs/config/toolchain",children:(0,i.jsx)(n.code,{children:".moon/toolchain.yml"})}),".\nThis new file will house all language and dependency manager specific settings."]}),"\n",(0,i.jsxs)(n.p,{children:["To migrate, move the ",(0,i.jsx)(n.code,{children:"node"})," and ",(0,i.jsx)(n.code,{children:"typescript"})," settings from ",(0,i.jsx)(n.code,{children:".moon/workspace.yml"})," to\n",(0,i.jsx)(n.code,{children:".moon/toolchain.yml"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"node:\n  # ...\n\ntypescript:\n  # ...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"moved-project-level-overrides",children:"Moved project-level overrides"}),"\n",(0,i.jsxs)(n.p,{children:["Continuing with the changes above, we've also moved the ",(0,i.jsx)(n.code,{children:"workspace.node"})," and ",(0,i.jsx)(n.code,{children:"workspace.typescript"}),"\nfrom ",(0,i.jsx)(n.a,{href:"../docs/config/project",children:(0,i.jsx)(n.code,{children:"moon.yml"})})," into a new parent field, ",(0,i.jsx)(n.code,{children:"toolchain"}),". We think this makes\nmore sense."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Before\nworkspace:\n  node:\n    version: '...'\n\n# After\ntoolchain:\n  node:\n    version: '...'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"future-of-the-toolchain",children:"Future of the toolchain"}),"\n",(0,i.jsxs)(n.p,{children:["We're really proud of our toolchain, as it avoids an array problems that developers deal with on a\nday to day basis, primarily around running tasks using the wrong version of Node.js or their chosen\npackage manager. While we're in the process of supporting additional languages, starting with\n",(0,i.jsx)(n.a,{href:"https://deno.land/",children:"Deno"}),', we had an idea... Since this is basically a better "version manager for\ntools", why not extract this out into something else?']}),"\n",(0,i.jsx)(n.p,{children:"And that's what we plan to do! Before we do so, we've had to make some architectural changes, many\nof which have landed in this release. During this process, we were able to implement an even better\ntoolchain, polish many of the edge cases, and improve performance! Stay tuned for more information\non this new tool!"}),"\n",(0,i.jsx)(n.h2,{id:"increased-output-hydration-by-8-10x",children:"Increased output hydration by 8-10x"}),"\n",(0,i.jsxs)(n.p,{children:["In moon, hydration is the concept of unpacking an existing hashed artifact into a\n",(0,i.jsx)(n.a,{href:"../docs/config/project#outputs",children:"task's outputs"})," during a cache hit. In our previous implementation,\nwe would delete all existing outputs before unpacking the archive to ensure a clean slate and to\navoid stale files. While this worked, it wasn't the most performant, taking about 280ms for 1,000\nfiles (which is still reasonably fast!)."]}),"\n",(0,i.jsxs)(n.p,{children:["In our new implementation, we now utilize a smart file tree diffing algorithm that will only unpack\nfiles ",(0,i.jsx)(n.em,{children:"with different content"}),", and will automatically remove stale files in the process. This has\nresulted in a 10x performance increase, taking about 30ms! Multiply this by many projects, the\nresults should be very apparent."]}),"\n",(0,i.jsx)(n.p,{children:"We hope you enjoy this improvement, as it's the first of many to come!"}),"\n",(0,i.jsx)(n.h2,{id:"cache-any-and-all-targets",children:"Cache any and all targets"}),"\n",(0,i.jsxs)(n.p,{children:["By default, all ",(0,i.jsx)(n.a,{href:"../docs/concepts/target",children:"targets"})," that produce outputs are cached and archived. For\ntargets that ",(0,i.jsx)(n.em,{children:"do not"})," produce outputs, like testing, linting, and typechecking, these are not\ncached. This will result in slower CI times as they are continuously ran, even if nothing has\nchanged. However with our new ",(0,i.jsx)(n.a,{href:"../docs/guides/remote-cache",children:"remote caching"})," layer, we can skip these\nfrom running entirely!"]}),"\n",(0,i.jsxs)(n.p,{children:["To achieve this, we've added a new setting to ",(0,i.jsx)(n.a,{href:"../docs/config/workspace",children:(0,i.jsx)(n.code,{children:".moon/workspace.yml"})}),"\ncalled ",(0,i.jsx)(n.a,{href:"../docs/config/workspace#archivabletargets",children:(0,i.jsx)(n.code,{children:"runner.archivableTargets"})}),". This setting\naccepts a list of targets that should be archived, regardless of whether or not they produce\noutputs."]}),"\n",(0,i.jsx)(n.p,{children:"For example, if we want to cache and archive testing, linting, and typechecking, we can define the\nfollowing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"runner:\n  archivableTargets:\n    - ':lint'\n    - ':test'\n    - ':typecheck'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"path-handling-in-generator-templates",children:"Path handling in generator templates"}),"\n",(0,i.jsxs)(n.p,{children:["Our code generation is powered by ",(0,i.jsx)(n.a,{href:"https://tera.netlify.app/docs/#built-ins",children:"Tera"}),", a templating\nengine with a ton of built-in utilities. However, it does not provide utilities for file paths, and\nas such, we now provide ",(0,i.jsx)(n.code,{children:"path_join"})," and ",(0,i.jsx)(n.code,{children:"path_relative"})," filters."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-twig",children:"{{ some_path | path_relative(from = workspace_root) }}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We also now inject variables for the working directory, destination, and workspace root. This will\nhelp with custom paths, especially within frontmatter!\n",(0,i.jsx)(n.a,{href:"../docs/guides/codegen#variables",children:"View the codegen docs for more information"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsxs)(n.p,{children:["View the\n",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/%40moonrepo%2Fcli%400.20.0",children:"official release"})," for a\nfull list of changes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Added ",(0,i.jsx)(n.code,{children:"vcs.remoteCandidates"})," to ",(0,i.jsx)(n.code,{children:".moon/workspace.yml"})," to customize the remotes for Git to query\nagainst."]}),"\n",(0,i.jsxs)(n.li,{children:["Added support for ",(0,i.jsx)(n.code,{children:"moduleSuffixes"})," and ",(0,i.jsx)(n.code,{children:"moduleDetection"})," in TypeScript ",(0,i.jsx)(n.code,{children:"tsconfig.json"})," compiler\noptions."]}),"\n",(0,i.jsxs)(n.li,{children:["YAML files will now respect the closest ",(0,i.jsx)(n.code,{children:".editorconfig"})," file."]}),"\n",(0,i.jsx)(n.li,{children:"Refactored terminal output for bette readability."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,i.jsx)(n.p,{children:"Expect the following in the v0.21 release!"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"An interactive dependency and project graph visualizer."}),"\n",(0,i.jsx)(n.li,{children:"A more performant project graph."}),"\n",(0,i.jsx)(n.li,{children:"More quality of life improvements for affected files."}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},78660:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/v0.20-2a89b9d56c8a682f8427bd0138afb959.png"}}]);