"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[12620],{24914:e=>{e.exports=JSON.parse('{"permalink":"/blog/moon-v1.12","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2023-08-21_moon-v1.12.mdx","source":"@site/blog/2023-08-21_moon-v1.12.mdx","title":"moon v1.12 - Task improvements: extending, interactive, and more","description":"In this release, we focused heavily on improving tasks, its configuration, and related systems.","date":"2023-08-21T00:00:00.000Z","tags":[{"inline":true,"label":"tasks","permalink":"/blog/tags/tasks"},{"inline":true,"label":"inheritance","permalink":"/blog/tags/inheritance"}],"readingTime":3.35,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v1.12","title":"moon v1.12 - Task improvements: extending, interactive, and more","authors":["milesj"],"tags":["tasks","inheritance"],"image":"./img/moon/v1.12.png"},"unlisted":false,"prevItem":{"title":"proto v0.15 - Install and uninstall globals","permalink":"/blog/proto-v0.15"},"nextItem":{"title":"proto v0.14 - Node.js and Rust now powered by WASM plugins","permalink":"/blog/proto-v0.14"}}')},43023:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(63696);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},54155:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var s=t(24914),i=t(62540),o=t(43023);const a={slug:"moon-v1.12",title:"moon v1.12 - Task improvements: extending, interactive, and more",authors:["milesj"],tags:["tasks","inheritance"],image:"./img/moon/v1.12.png"},r=void 0,l={image:t(68936).A,authorsImageUrls:[void 0]},c=[{value:"Extending sibling or inherited tasks",id:"extending-sibling-or-inherited-tasks",level:2},{value:"Configure tasks as interactive",id:"configure-tasks-as-interactive",level:2},{value:"Tokens in environment variables",id:"tokens-in-environment-variables",level:2},{value:"Other changes",id:"other-changes",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In this release, we focused heavily on improving tasks, its configuration, and related systems."}),"\n",(0,i.jsx)(n.h2,{id:"extending-sibling-or-inherited-tasks",children:"Extending sibling or inherited tasks"}),"\n",(0,i.jsxs)(n.p,{children:["Three months ago, we posted an\n",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/issues/849",children:"RFC on how to support task extending / task variants"}),".\nOn paper this doesn't sound like a hard problem to solve, but internally it would of been an uphill\nbattle to implement. Thanks to previous releases from the past few months, and the rewrite of the\nproject graph, task builder, and more, this implementation was a breeze. To finalize the RFC, we\nwent with option 2, by adding a new ",(0,i.jsx)(n.code,{children:"extends"})," field to task configurations."]}),"\n",(0,i.jsx)(n.p,{children:"With this new addition, we can now rewrite this old configuration, which was needlessly\nrepetitive..."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  lint:\n    command: 'eslint .'\n    inputs:\n      - '@globs(sources)'\n      - '@globs(tests)'\n      - '*.js'\n      - '.eslintrc.js'\n      - 'tsconfig.json'\n      - '/.eslintignore'\n      - '/.eslintrc.js'\n      - '/tsconfig.eslint.json'\n      - '/tsconfig.options.json'\n\n  lint-fix:\n    command: 'eslint . --fix'\n    local: true\n    inputs:\n      - '@globs(sources)'\n      - '@globs(tests)'\n      - '*.js'\n      - '.eslintrc.js'\n      - 'tsconfig.json'\n      - '/.eslintignore'\n      - '/.eslintrc.js'\n      - '/tsconfig.eslint.json'\n      - '/tsconfig.options.json'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Into the following configuration."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  lint:\n    command: 'eslint .'\n    inputs:\n      - '@globs(sources)'\n      - '@globs(tests)'\n      - '*.js'\n      - '.eslintrc.js'\n      - 'tsconfig.json'\n      - '/.eslintignore'\n      - '/.eslintrc.js'\n      - '/tsconfig.eslint.json'\n      - '/tsconfig.options.json'\n\n  lint-fix:\n    extends: 'lint'\n    args: '--fix'\n    local: true\n"})}),"\n",(0,i.jsx)(n.p,{children:"We're very happy with this solution, as it's far more readable, maintainable, and doesn't introduce\nyet another paradigm to learn. Our goal was to be as familiar as possible, while providing extensive\nfunctionality behind the scenes, which we believe to have achieved."}),"\n",(0,i.jsx)(n.p,{children:"Some other interesting facts around task extending:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When extending a task, ",(0,i.jsx)(n.a,{href:"/docs/concepts/task-inheritance#merge-strategies",children:"merge strategies"})," are\napplied in a similar fashion to inheritance."]}),"\n",(0,i.jsx)(n.li,{children:"Inherited tasks can be extended from by project-level tasks."}),"\n",(0,i.jsx)(n.li,{children:"It's possible to create multiple extended chains."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configure-tasks-as-interactive",children:"Configure tasks as interactive"}),"\n",(0,i.jsxs)(n.p,{children:["Six months ago, we added support for ",(0,i.jsx)(n.a,{href:"./v0.24#interactive-tasks",children:"interactive tasks in v0.24"}),", but\nonly if certain conditions were met: if only 1 target is running, they are considered interactive,\nor if the ",(0,i.jsx)(n.code,{children:"--interactive"})," option was passed to ",(0,i.jsx)(n.a,{href:"/docs/commands/run",children:(0,i.jsx)(n.code,{children:"moon run"})}),". However, we believe\nit nice to support interactive tasks through task configuration directly, but it required some\nthought into how this would work within the dependency graph and pipeline, as only 1 task can\ninteract with stdin at a time."]}),"\n",(0,i.jsx)(n.p,{children:"We solved this problem by reworking our dependency graph so that interactive tasks are isolated from\nother actions in the graph, and are not run in parallel with other actions. This will result in\nlonger dependency chains, but results in a working stdin solution."}),"\n",(0,i.jsxs)(n.p,{children:["To mark a task as interactive, enable the ",(0,i.jsx)(n.a,{href:"/docs/config/project#interactive",children:(0,i.jsx)(n.code,{children:"options.interactive"})}),"\nsetting."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  init:\n    command: 'init-app'\n    options:\n      interactive: true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"tokens-in-environment-variables",children:"Tokens in environment variables"}),"\n",(0,i.jsxs)(n.p,{children:["Up until now, ",(0,i.jsx)(n.a,{href:"/docs/concepts/token",children:"token functions and variables"})," were only supported in task\ncommands, args, inputs, and outputs, but not environment variables... why? Honestly, there was no\nreal reason they weren't supported, it simply never crossed our mind! But thanks to requests from\nthe community, both token functions and variables are now supported in task\n",(0,i.jsx)(n.a,{href:"/docs/config/project#env-1",children:(0,i.jsx)(n.code,{children:"env"})}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This is great for propagating moon values to other systems. For example, say you want to use moon\nproject names for Sentry, keeping a 1:1 mapping."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  start:\n    command: 'run-server'\n    env:\n      SENTRY_PROJECT: '$project'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you're familiar with tokens, you may be asking yourself, \"How do token functions work since they\nexpand to a list of paths?\" That's a great question! When token functions are used in an environment\nvariable, like ",(0,i.jsx)(n.code,{children:"@group(sources)"}),", the list of paths will be joined with a comma (",(0,i.jsx)(n.code,{children:","}),")."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  build:\n    # ...\n    env:\n      SRCS: '@group(sources)'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Since the environment variable is simply a string, you could parse it with your language of choice\nto extract the list of paths."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const paths = process.env.SRCS.split(',');\n"})}),"\n",(0,i.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsxs)(n.p,{children:["View the ",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.12.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Added git worktree support."}),"\n",(0,i.jsxs)(n.li,{children:["Updated task ",(0,i.jsx)(n.code,{children:"outputs"})," to support negated globs."]}),"\n",(0,i.jsxs)(n.li,{children:["Will now log a warning to the console if a configuration file uses the ",(0,i.jsx)(n.code,{children:".yaml"})," extension."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},68936:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/v1.12-3a89ebd0fa3a2732d0f38951967f4d19.png"}}]);