"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[53457],{21310:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var i=t(35461),o=t(62540),l=t(43023);const s={slug:"moon-v1.36",title:"moon v1.36 - Toolchain plugins beta, optimized remote caching, and codegen improvements",authors:["milesj"],tags:["toolchain","wasm","plugin","remote","cache","integrity","codegen","template"],image:"./img/moon/v1.36.png"},a=void 0,r={image:t(77526).A,authorsImageUrls:[void 0]},c=[{value:"Beta release of toolchain WASM plugins",id:"beta-release-of-toolchain-wasm-plugins",level:2},{value:"Optimized remote caching",id:"optimized-remote-caching",level:2},{value:"Improved code generation",id:"improved-code-generation",level:2},{value:"Archive URLs",id:"archive-urls",level:3},{value:"Array and object types",id:"array-and-object-types",level:3},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"In this release, we're very excited to fully release toolchain plugins!"}),"\n",(0,o.jsx)(n.h2,{id:"beta-release-of-toolchain-wasm-plugins",children:"Beta release of toolchain WASM plugins"}),"\n",(0,o.jsxs)(n.p,{children:["Two months ago we announced ",(0,o.jsx)(n.a,{href:"./moon-v1.33",children:"alpha toolchain plugins"})," with support for tier 3, but not\ntier 2. The reason for this was that tier 3 is powered by ",(0,o.jsx)(n.a,{href:"/docs/proto/wasm-plugin",children:"proto APIs"}),",\nwhich already existed! We simply hooked them up to moon. The bulk of the remaining plugin work was\ntier 2 support, which we are excited to announce has been completed! The following APIs have been\nimplemented:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"extend_project_graph"})," - Extend projects with toolchain specific info."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"extend_task_command"})," - Extend the command child process with parameters."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"extend_task_script"})," - Extend the script child process with parameters."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"locate_dependencies_root"})," - Locate the package dependencies workspace root."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"parse_manifest"})," - Parse a manifest file to extract dependencies."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"parse_lock"})," - Parse a lock file to extract resolved dependencies."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"And the following surface areas have been integrated with:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["In the project graph:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Extend projects with dependencies, tasks, and an alias."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["In the action pipeline:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Added ",(0,o.jsx)(n.code,{children:"SetupEnvironment"})," action that executes the ",(0,o.jsx)(n.code,{children:"setup_environment"})," API."]}),"\n",(0,o.jsxs)(n.li,{children:["Added ",(0,o.jsx)(n.code,{children:"InstallDependencies"})," action that executes the ",(0,o.jsx)(n.code,{children:"install_dependencies"})," API."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["When running tasks:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Extend the command/script with additional parameters before executing."}),"\n",(0,o.jsx)(n.li,{children:"Inject dependency and lock information into the hash."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["With Docker:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Updated ",(0,o.jsx)(n.code,{children:"docker prune"})," to utilize the new WASM APIs for toolchain plugins."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"As of this release, all 27 APIs have been implemented, and toolchain plugins are now available for\ngeneral use! However, they are still quite unstable, not fully tested, and the APIs may change\nbetween releases, but you can start using them today if you're feeling adventurous!"}),"\n",(0,o.jsx)(n.p,{children:"With all this said, we do not have documentation yet. We plan to slowly work on this across the next\nfew releases. In the meantime, check out the following resources for more information:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://docs.rs/moon_pdk/",children:(0,o.jsx)(n.code,{children:"moon_pdk"})})," - Rust plugin development kit."]}),"\n",(0,o.jsxs)(n.li,{children:["Existing ",(0,o.jsx)(n.a,{href:"https://github.com/moonrepo/plugins/tree/master/toolchains",children:"toolchain plugins"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["In development ",(0,o.jsx)(n.a,{href:"https://github.com/moonrepo/plugins/pull/48",children:"Rust toolchain"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"optimized-remote-caching",children:"Optimized remote caching"}),"\n",(0,o.jsx)(n.p,{children:"Like the past few releases, we've made some improvements to the remote caching layer."}),"\n",(0,o.jsxs)(n.p,{children:["To start, we're adding a new\n",(0,o.jsx)(n.a,{href:"/docs/config/workspace#verifyintegrity",children:(0,o.jsx)(n.code,{children:"unstable_remote.cache.verifyIntegrity"})})," setting, that will\nverify the digest (hash) of downloaded blobs to ensure they aren't corrupted or incomplete. We\ncurrently check the file size, but this will also now check the content. This setting will slightly\ndegrade performance but ensure reliability."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"unstable_remote:\n  cache:\n    verifyIntegrity: true\n"})}),"\n",(0,o.jsx)(n.p,{children:"While we're on the topic of reliability, we're also introducing an implicit rollback mechanic that\nwill remove partially downloaded or incomplete blobs if hydration ever fails at some point. This\nwill also run between executions to ensure there are no stale artifacts lying around."}),"\n",(0,o.jsxs)(n.p,{children:["And lastly, we've parallelized the blob existence checks, reducing the amount of large requests for\nheavy tasks, and reworked how we inherit ",(0,o.jsx)(n.code,{children:"MOON_REMOTE_*"})," environment variables."]}),"\n",(0,o.jsx)(n.h2,{id:"improved-code-generation",children:"Improved code generation"}),"\n",(0,o.jsx)(n.p,{children:"It's been a while since we've added new features to code generation, but thanks to some great\nrequests from the community, we have 2 this release!"}),"\n",(0,o.jsx)(n.h3,{id:"archive-urls",children:"Archive URLs"}),"\n",(0,o.jsxs)(n.p,{children:["The first is that ",(0,o.jsx)(n.a,{href:"/docs/guides/codegen#archive-urls",children:"remote archives"})," (zip, tar, etc) can be used\nas template locations. The archive will then be downloaded and unpacked into ",(0,o.jsx)(n.code,{children:"~/.moon/templates"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"generator:\n  templates:\n    - 'https://domain.com/some/path/to/archive.zip'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"array-and-object-types",children:"Array and object types"}),"\n",(0,o.jsxs)(n.p,{children:["The second is that we now support ",(0,o.jsx)(n.code,{children:"array"})," and ",(0,o.jsx)(n.code,{children:"object"}),"\n",(0,o.jsx)(n.a,{href:"/docs/config/template#variables",children:"variable types"})," in ",(0,o.jsx)(n.code,{children:"template.yml"}),". The values within each of these\ncollections can be any JSON-compatible type."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="template.yml"',children:"variables:\n  type:\n    type: 'array'\n    prompt: 'Type?'\n    default: ['app', 'lib']\n  metadata:\n    type: 'object'\n    prompt: 'Metadata?'\n    default:\n      internal: true\n"})}),"\n",(0,o.jsx)(n.p,{children:"These variables and their nested values can then be accessed within templates using dot or bracket\nnotation."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-twig",children:"{{ type[0] }}\n{{ metadata.internal }}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,o.jsxs)(n.p,{children:["View the ",(0,o.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.36.0",children:"official release"})," for a full list\nof changes."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Added ",(0,o.jsx)(n.code,{children:"--host"})," and ",(0,o.jsx)(n.code,{children:"--port"})," options to ",(0,o.jsx)(n.code,{children:"moon action-graph"}),", ",(0,o.jsx)(n.code,{children:"moon task-graph"}),", and\n",(0,o.jsx)(n.code,{children:"moon project-graph"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Added ",(0,o.jsx)(n.code,{children:"--stdin"})," option to ",(0,o.jsx)(n.code,{children:"moon ci"})," and ",(0,o.jsx)(n.code,{children:"moon run"}),", which will allow touched files to be passed\nvia stdin, instead of running VCS commands to determine them."]}),"\n",(0,o.jsxs)(n.li,{children:["Removed the restriction around ",(0,o.jsx)(n.code,{children:"moon.{yml,pkl}"})," not being allowed as a task input. However, will\nnot be included when using ",(0,o.jsx)(n.code,{children:"**/*"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,o.jsx)(n.p,{children:"Now that toolchain plugins are in beta, we can take the next step in migrating an existing platform\ninto a toolchain."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Migrate the Rust toolchain to a WASM plugin."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},35461:e=>{e.exports=JSON.parse('{"permalink":"/blog/moon-v1.36","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2025-05-18_moon-v1.36.mdx","source":"@site/blog/2025-05-18_moon-v1.36.mdx","title":"moon v1.36 - Toolchain plugins beta, optimized remote caching, and codegen improvements","description":"In this release, we\'re very excited to fully release toolchain plugins!","date":"2025-05-18T00:00:00.000Z","tags":[{"inline":true,"label":"toolchain","permalink":"/blog/tags/toolchain"},{"inline":true,"label":"wasm","permalink":"/blog/tags/wasm"},{"inline":true,"label":"plugin","permalink":"/blog/tags/plugin"},{"inline":true,"label":"remote","permalink":"/blog/tags/remote"},{"inline":true,"label":"cache","permalink":"/blog/tags/cache"},{"inline":true,"label":"integrity","permalink":"/blog/tags/integrity"},{"inline":true,"label":"codegen","permalink":"/blog/tags/codegen"},{"inline":true,"label":"template","permalink":"/blog/tags/template"}],"readingTime":3.64,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v1.36","title":"moon v1.36 - Toolchain plugins beta, optimized remote caching, and codegen improvements","authors":["milesj"],"tags":["toolchain","wasm","plugin","remote","cache","integrity","codegen","template"],"image":"./img/moon/v1.36.png"},"unlisted":false,"prevItem":{"title":"moon v1.37 - Rust WASM toolchain and MCP support","permalink":"/blog/moon-v1.37"},"nextItem":{"title":"moon v1.35 - Action graph improvements, task priorities, and more!","permalink":"/blog/moon-v1.35"}}')},43023:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(63696);const o={},l=i.createContext(o);function s(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(l.Provider,{value:n},e.children)}},77526:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/v1.36-d38e3a27ac0e1396e6045d5260ed5bd1.png"}}]);