"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[63559],{33145:e=>{e.exports=JSON.parse('{"permalink":"/blog/moon-v1.8","editUrl":"https://github.com/moonrepo/moon/tree/master/website/blog/2023-06-12_moon-v1.8.mdx","source":"@site/blog/2023-06-12_moon-v1.8.mdx","title":"moon v1.8 - Code owners and shared configuration","description":"With this release, we\'ve focused on a critical facet of managing a large codebase, source code","date":"2023-06-12T00:00:00.000Z","tags":[{"inline":true,"label":"source","permalink":"/blog/tags/source"},{"inline":true,"label":"code","permalink":"/blog/tags/code"},{"inline":true,"label":"owners","permalink":"/blog/tags/owners"},{"inline":true,"label":"ownership","permalink":"/blog/tags/ownership"}],"readingTime":3.7,"hasTruncateMarker":true,"authors":[{"name":"Miles Johnson","title":"Founder, developer","url":"https://github.com/milesj","imageURL":"/img/authors/miles.jpg","key":"milesj","page":null}],"frontMatter":{"slug":"moon-v1.8","title":"moon v1.8 - Code owners and shared configuration","authors":["milesj"],"tags":["source","code","owners","ownership"],"image":"./img/moon/v1.8.png"},"unlisted":false,"prevItem":{"title":"proto v0.11 - New shims and better logging","permalink":"/blog/proto-v0.11"},"nextItem":{"title":"moon v1.7 - Next-generation configuration and errors","permalink":"/blog/moon-v1.7"}}')},43023:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>a});var s=o(63696);const r={},i=s.createContext(r);function t(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(i.Provider,{value:n},e.children)}},58596:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});var s=o(33145),r=o(62540),i=o(43023);const t={slug:"moon-v1.8",title:"moon v1.8 - Code owners and shared configuration",authors:["milesj"],tags:["source","code","owners","ownership"],image:"./img/moon/v1.8.png"},a=void 0,c={image:o(92745).A,authorsImageUrls:[void 0]},l=[{value:"Support for code ownership",id:"support-for-code-ownership",level:2},{value:"Generate a <code>CODEOWNERS</code>",id:"generate-a-codeowners",level:3},{value:"New project <code>owners</code> setting",id:"new-project-owners-setting",level:3},{value:"New <code>moon sync codeowners</code> command",id:"new-moon-sync-codeowners-command",level:3},{value:"Community-driven task configuration",id:"community-driven-task-configuration",level:2},{value:"Other changes",id:"other-changes",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"With this release, we've focused on a critical facet of managing a large codebase, source code\nownership, and sharing task configuration."}),"\n",(0,r.jsx)(n.h2,{id:"support-for-code-ownership",children:"Support for code ownership"}),"\n",(0,r.jsx)(n.p,{children:"An important workflow for companies of any size is reviewing code, and ensuring the right people are\nreviewing and approving that code. This is especially true for large companies with hundreds of\ndevelopers, or many distinct teams working in a single codebase."}),"\n",(0,r.jsxs)(n.p,{children:["Popular VCS providers like ",(0,r.jsx)(n.a,{href:"https://github.com/",children:"GitHub"}),", ",(0,r.jsx)(n.a,{href:"https://about.gitlab.com/",children:"GitLab"}),", and\n",(0,r.jsx)(n.a,{href:"https://bitbucket.org/product/",children:"Bitbucket"})," provide built-in features to handle such workflows,\naptly named code owners. They all achieve this through a similar mechanism, a single ",(0,r.jsx)(n.code,{children:"CODEOWNERS"}),"\nfile that maps file system paths to owners (users, teams, groups, etc). These owners are then\nrequired to approve a pull/merge request because it can be merged into the base branch."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["For more information, view our official in-depth ",(0,r.jsx)(n.a,{href:"/docs/guides/codeowners",children:"code owners guide"}),"!"]})}),"\n",(0,r.jsxs)(n.h3,{id:"generate-a-codeowners",children:["Generate a ",(0,r.jsx)(n.code,{children:"CODEOWNERS"})]}),"\n",(0,r.jsxs)(n.p,{children:["Managing the ",(0,r.jsx)(n.code,{children:"CODEOWNERS"})," file manually can be a tedious task, especially when you have hundreds of\nprojects. To help with this, moon can generate the ",(0,r.jsx)(n.code,{children:"CODEOWNERS"})," file for you,\n",(0,r.jsx)(n.a,{href:"#new-project-owners-setting",children:"based on project owners"}),", formatted to your VCS provider of choice.\nThis helps to avoid an out-of-date ownership file!"]}),"\n",(0,r.jsxs)(n.p,{children:["We're introducing a few new workspace settings to handle this, the first is\n",(0,r.jsx)(n.a,{href:"/docs/config/workspace#codeowners",children:(0,r.jsx)(n.code,{children:"codeowners"})}),", which enables and configure code ownership as a\nwhole, and the second is ",(0,r.jsx)(n.a,{href:"/docs/config/workspace#provider",children:(0,r.jsx)(n.code,{children:"vcs.provider"})}),", which determines the VCS\nprovider to generate the file for (and unlocks future features)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/workspace.yml"',children:"codeowners:\n  syncOnRun: true\n  globalPaths:\n    '*': ['@admins']\n\nvcs:\n  manager: 'git'\n  provider: 'github'\n"})}),"\n",(0,r.jsx)(n.p,{children:"The settings above will generate the following file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",metastring:'title=".github/CODEOWNERS"',children:"# (workspace)\n* @admins\n"})}),"\n",(0,r.jsx)(n.p,{children:"While this looks very simple, it really shines once projects start adding their own granular code\nownership. Continue reading for more information!"}),"\n",(0,r.jsxs)(n.h3,{id:"new-project-owners-setting",children:["New project ",(0,r.jsx)(n.code,{children:"owners"})," setting"]}),"\n",(0,r.jsxs)(n.p,{children:["To make use of code owners, you'll need to define an ",(0,r.jsx)(n.a,{href:"/docs/config/project#owners",children:(0,r.jsx)(n.code,{children:"owners"})})," setting\nin a project's ",(0,r.jsx)(n.a,{href:"/docs/config/project",children:(0,r.jsx)(n.code,{children:"moon.yml"})})," file. This setting requires a list/map of owners\n(contributors required to review) associated to file paths/patterns, relative from the current\nproject's root."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="packages/components/moon.yml"',children:"owners:\n  paths:\n    'src/': ['@frontend', '@design-system']\n    '*.config.js': ['@frontend-infra']\n    '*.json': ['@frontend-infra']\n"})}),"\n",(0,r.jsxs)(n.p,{children:["These paths will then be prefixed with the project source when\n",(0,r.jsxs)(n.a,{href:"#generate-a-codeowners",children:["generating the ",(0,r.jsx)(n.code,{children:"CODEOWNERS"})]})," file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",metastring:'title=".github/CODEOWNERS"',children:"# components\n/packages/components/src/ @frontend @design-system\n/packages/components/*.config.js @frontend-infra\n/packages/components/*.json @frontend-infra\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"new-moon-sync-codeowners-command",children:["New ",(0,r.jsx)(n.code,{children:"moon sync codeowners"})," command"]}),"\n",(0,r.jsxs)(n.p,{children:["Although moon can ",(0,r.jsx)(n.a,{href:"/docs/config/workspace#synconrun",children:"automatically generate"})," the ",(0,r.jsx)(n.code,{children:"CODEOWNERS"})," file\nwhen running a target, there may be situations where this is disabled, or teams/developers would\nlike to generate the file manually. To handle this, we're providing the\n",(0,r.jsx)(n.a,{href:"/docs/commands/sync/codeowners",children:(0,r.jsx)(n.code,{children:"moon sync codeowners"})})," command, which will trigger the generation\nprocess."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"$ moon sync codeowners\n"})}),"\n",(0,r.jsx)(n.h2,{id:"community-driven-task-configuration",children:"Community-driven task configuration"}),"\n",(0,r.jsxs)(n.p,{children:["A powerful but often overlooked feature of moon is the ability to\n",(0,r.jsx)(n.a,{href:"/docs/guides/sharing-config",children:"share and extend task configuration"})," from remote sources. This is\nextremely useful in..."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Providing a single source of truth for configuration."}),"\n",(0,r.jsx)(n.li,{children:"Reducing task duplication across projects."}),"\n",(0,r.jsx)(n.li,{children:"Ensuring tasks are battle-tested and ready for use."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The other upside of this approach is that configuration can be ",(0,r.jsx)(n.em,{children:"community-driven"}),"! To support this\nas a first-class feature, we're launching the\n",(0,r.jsxs)(n.a,{href:"https://github.com/moonrepo/moon-configs",children:[(0,r.jsx)(n.code,{children:"moon-configs"})," repository"]}),", a collection of task\nconfigurations for popular programming languages, frameworks, libraries, and more! As of now, the\nrepository is kind of empty, but we're hoping to grow it over time, so feel free to contribute!"]}),"\n",(0,r.jsxs)(n.p,{children:["If you're curious how this works in practice, we'll use our Rust configuration as an example. The\nentire system is based around ",(0,r.jsx)(n.a,{href:"/docs/concepts/task-inheritance",children:"tag inheritance"}),", where a project\ncan inherit tasks from a remote source, and then extend or override them as needed. For example,\ncreate the tag-based config:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/tasks/tag-rust.yml"',children:"extends: 'https://raw.githubusercontent.com/moonrepo/moon-configs/master/rust/tasks-workspace.yml'\n"})}),"\n",(0,r.jsx)(n.p,{children:"And then in Rust projects that you'd like to inherit these tasks, add the following tags:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="<project>/moon.yml"',children:"tags: ['rust']\n"})}),"\n",(0,r.jsx)(n.p,{children:"It's as simple as that!"}),"\n",(0,r.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,r.jsxs)(n.p,{children:["View the ",(0,r.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.8.0",children:"official release"})," for a full list of\nchanges."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Added a new action to the graph, ",(0,r.jsx)(n.code,{children:"SyncWorkspace"}),", that'll be used for workspace-level checks."]}),"\n",(0,r.jsxs)(n.li,{children:["Added ",(0,r.jsx)(n.code,{children:"MOON_OUTPUT_STYLE"})," and ",(0,r.jsx)(n.code,{children:"MOON_RETRY_COUNT"})," environment variables."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},92745:(e,n,o)=>{o.d(n,{A:()=>s});const s=o.p+"assets/images/v1.8-39d52ddb273bfa80248ada1b595a488e.png"}}]);